<!--
some assets
https://fate-go.us/assets/img/pc/common/bg_ptn.gif
-->

<!DOCTYPE html>
<html>
<head>
    <title>Health Condition Predictor</title>
    <script src="https://cdn.jsdelivr.net/pyodide/v0.27.4/full/pyodide.js"></script>
    <style>
        @font-face {
            font-family: 'FranklinGotItcTEEMed';
            src: url('FranklinGotItcTEEMed.ttf') format('woff2'),
                url('FranklinGotItcTEEMed.ttf') format('woff');
            font-weight: normal;
            font-style: normal;
        }
        body {
            display: flex;
            justify-content: center;
            background-image: url(the.png);
        }
        #loading {
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url(the.png);
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgb(0, 0, 0);
            font-family: 'FranklinGotItcTEEMed';
        } 
        #loading > div {
            display: flex;
            justify-content: center;
            align-items: center;
            height: auto;
            width: 30vi;
            text-align: center;
            font-size: clamp(40px, 5vi, 75px);
            
        }
        #loading > div > img {
            width: clamp(40px, 5vi, 75px); 
            height: clamp(40px, 5vi, 75px);
        }
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 1; /* Sit on top */
            padding-top: 100px; /* Location of the box */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgb(0,0,0); /* Fallback color */
            background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
        }

            /* Modal Content */
        .modal-content {
            background-color: #fefefe;
            margin: auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
        }

            /* The Close Button */
        .close {
            color: #aaaaaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }

        .close:hover,
        .close:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
        }
        pre {
            white-space: pre-wrap;       /* Since CSS 2.1 */
            white-space: -moz-pre-wrap;  /* Mozilla, since 1999 */
            white-space: -pre-wrap;      /* Opera 4-6 */
            white-space: -o-pre-wrap;    /* Opera 7 */
            word-wrap: break-word;       /* Internet Explorer 5.5+ */
        }
    </style>
    <body>
        <div id="loading">
            <div>
                <img src="cd-rom.gif" id="stylishgif">&nbsp;&nbsp;<p id="loadingtext">Loading...</p>
            </div>
        </div>
        <div>
            <h2>Health Condition Predictor</h2>
            <label>Age: <input type="number" id="age"></label><br>
            <label><input class="cb" type="checkbox" id="cough"> Cough</label><br>
            <label><input class="cb" type="checkbox" id="fever"> Fever</label><br>
            <label><input class="cb" type="checkbox" id="shortness_of_breath"> Shortness of Breath</label><br>
            <label><input class="cb" type="checkbox" id="wheezing"> wheezing</label><br>
            <label><input class="cb" type="checkbox" id="weight_loss"> weight_loss</label><br>
            <label><input class="cb" type="checkbox" id="chest_pain"> chest_pain</label><br>
            <label><input class="cb" type="checkbox" id="fatigue"> fatigue</label><br>
            <label><input class="cb" type="checkbox" id="sore_throat"> sore_throat</label><br>
            <label><input class="cb" type="checkbox" id="night_sweats"> night_sweats</label><br>
            <label><input class="cb" type="checkbox" id="loss_of_appetite"> loss_of_appetite</label><br>
            <button onclick="predict()">Predict</button>
            <h3 id="result"></h3>
        </div>
        <div id="myModal" class="modal">
            <!-- Modal content -->
            <div class="modal-content">
              <span class="close">&times;</span>
              <p id="modaltext">Some text in the Modal..</p>
            </div>
        </div>          
    </body>
    <script>
        var modal = document.getElementById("myModal");
        var span = document.getElementsByClassName("close")[0];

        async function loadPyodideAndPackages() {
            document.getElementById("loading").style.display = "flex";
            window.pyodide = await loadPyodide();
            await pyodide.loadPackage(["pandas", "scikit-learn"]);
            document.getElementById("loadingtext").innerText = `Finished!`;
            await pyodide.runPythonAsync(`
                import pandas as pd
                from sklearn.ensemble import RandomForestClassifier
                from sklearn.model_selection import train_test_split
                
                data = {
                    'age': [25, 30, 45, 50, 15, 60, 35, 40, 55, 20, 28, 65, 70, 22, 33, 42, 38, 27, 58, 47],
                    'cough': [1, 1, 1, 1, 1, 1, 0, 0, 1, 0, 1, 1, 1, 0, 1, 1, 0, 1, 1, 0],
                    'fever': [0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 1, 0, 0, 1, 0, 0, 1, 0],
                    'shortness_of_breath': [1, 1, 0, 1, 1, 0, 0, 1, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 1, 0],
                    'wheezing': [1, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0],
                    'weight_loss': [0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0, 0, 1, 0],
                    'chest_pain': [0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0, 0, 1, 0],
                    'fatigue': [0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 1, 1, 1, 0, 0, 1, 0, 0, 1, 0],
                    'sore_throat': [0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 1, 0, 0, 1, 0, 0, 1],
                    'night_sweats': [0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0, 0, 1, 0],
                    'loss_of_appetite': [0, 0, 1, 1, 0, 1, 0, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0, 0, 1, 0],
                    'diagnosis': [
                        'asthma', 'asthma', 'tb', 'tb', 'asthma', 'tb', 'no_disease', 'asthma', 'tb', 'no_disease',
                        'asthma', 'tb', 'tb', 'no_disease', 'asthma', 'tb', 'no_disease', 'asthma', 'tb', 'no_disease'
                    ]
                }
                df = pd.DataFrame(data)
                X = df.drop('diagnosis', axis=1)
                y = df['diagnosis']
                X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)
                model = RandomForestClassifier()
                model.fit(X_train, y_train)
                feature_names = X.columns.tolist()

                def predict_health_condition(user_data):
                    user_df = pd.DataFrame([user_data], columns=feature_names)
                    if sum(list(user_data.values())[1:]) < 3:
                        return 'no_disease'
                    else:
                        return model.predict(user_df)[0]
            `);
            document.getElementById("loading").style.display = "none";
        }

        async function predict() {
            let user_data = {
                'age': parseInt(document.getElementById('age').value),
                'cough': document.getElementById('cough').checked ? 1 : 0,
                'fever': document.getElementById('fever').checked ? 1 : 0,
                'shortness_of_breath': document.getElementById('shortness_of_breath').checked ? 1 : 0,
                'wheezing': document.getElementById('wheezing').checked ? 1 : 0,
                'weight_loss': document.getElementById('weight_loss').checked ? 1 : 0,
                'chest_pain': document.getElementById('chest_pain').checked ? 1 : 0,
                'fatigue': document.getElementById('fatigue').checked ? 1 : 0,
                'sore_throat': document.getElementById('sore_throat').checked ? 1 : 0,
                'night_sweats': document.getElementById('night_sweats').checked ? 1 : 0,
                'loss_of_appetite': document.getElementById('loss_of_appetite').checked ? 1 : 0,
            };
            let prediction = await pyodide.runPythonAsync(`predict_health_condition(${JSON.stringify(user_data)})`);
            modal.style.display = "block";
            document.getElementById('modaltext').innerText = `Predicted Condition: ${prediction}`;
            if (prediction == "asthma") {
                document.getElementById('modaltext').insertAdjacentHTML('afterend', 
                    `<p id="remove">
                        Looks like you might have asthma.<br>
                        <br>
                        What is Asthma?<br>
                        Asthma is a chronic respiratory condition that causes inflammation and narrowing of the airways,<br>
                        leading to symptoms like wheezing, coughing, shortness of breath, and chest tightness.<br>
                        <br>
                        Key Facts:<br>
                        - Asthma affects over 260 million people worldwide (WHO, 2023).<br>
                        - Common triggers include allergens, pollution, cold air, and exercise.<br>
                        - Asthma is manageable with proper treatment, such as inhalers and avoiding triggers.<br>
                        <br>
                        What You Should Do:<br>
                        - Consult a healthcare professional for a detailed diagnosis.<br>
                        - Use prescribed inhalers or medications as directed.<br>
                        - Avoid known triggers and monitor your symptoms.
                    </p>`
                );
            } else if (prediction == "tb") {
                document.getElementById('modaltext').insertAdjacentHTML('afterend', 
                    `<p id="remove">
                        Looks like you might have tuberculosis (TB).<br>
                        <br>
                        What is Tuberculosis (TB)?<br>
                        TB is an infectious disease caused by the bacterium Mycobacterium tuberculosis.<br>
                        It primarily affects the lungs but can also impact other parts of the body.<br>
                        <br>
                        Key Facts:<br>
                        - TB is one of the top 10 causes of death worldwide (WHO, 2023).<br>
                        - Symptoms include persistent cough, fever, night sweats, and weight loss.<br>
                        - TB is curable with a 6-9 month course of antibiotics.<br>
                        <br>
                        What You Should Do:<br>
                        - Visit a healthcare provider immediately for a TB test (e.g., sputum test or chest X-ray).<br>
                        - If diagnosed, follow the full course of treatment to prevent drug-resistant TB.<br>
                        - Practice good hygiene, such as covering your mouth when coughing.
                    </p>`
                );
            } else {
                document.getElementById('modaltext').insertAdjacentHTML('afterend', 
                    `<p id="remove">
                        Looks like you do not have asthma or tuberculosis.<br>
                        <br>
                        What Could It Be?<br>
                        Your symptoms do not strongly indicate asthma or TB. However, you may be experiencing a mild respiratory infection, <br>
                        allergies, or another condition.<br>
                        <br>
                        What You Should Do:<br>
                        - Monitor your symptoms and rest.<br>
                        - If symptoms persist or worsen, consult a healthcare professional.<br>
                        - Stay hydrated and avoid irritants like smoke or pollution.
                    </p>`
                );
            }

            message = document.getElementById("remove")
        }

        function resetAllInputs() {
            document.querySelectorAll('input, select, textarea').forEach(element => {
                if (element.type === 'checkbox' || element.type === 'radio') {
                    element.checked = false;
                } else {
                    element.value = '';
                }
            });
        }

        loadPyodideAndPackages();

        span.onclick = function() {
            modal.style.display = "none";
            message.remove();
            resetAllInputs();
        }

            // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
            if (event.target == modal) {
                modal.style.display = "none";
                message.remove();
                resetAllInputs();
            }
        }
    </script>
</head>
</html>
